# AWSOrganizations組織管理システム 要件定義書

## 1. 概要

### 1.1. はじめに
本書は、AWS Organizationsの管理アカウントのシステムにおける要件を定義するものである。
ポートフォリオ目的のシステムとなるが、商用利用を想定したシステムを作成する。但し、コストが発生する内容についてはコスト効率を優先する。

### 1.2. プロジェクトの背景
AWSを利用するにあたり、ベストプラクティスであるAWS Organizationsを利用して一元管理する。管理アカウント側に用意するシステムについて定義する。

### 1.3. プロジェクトの目的

*   複数アカウントの効率的な一元管理（OU）。
*   セキュリティガバナンスの強化（SCP）。
*   コスト管理の最適化と簡素化（原則、コストは発生しない想定）。


## 2. システム概要

### 2.1. システム全体像

MGCPを参照

### 2.2. システム構成図

`システム構成図.drawio`を参照

### 2.3. 利用者

内部システムのため、関係者のみが対象。


## 3. 機能要件

本システム（AWS Organizations管理基盤）は、組織のAWSアカウントを安全かつ効率的に管理するための統制機能を提供する。

### 3.1. 機能一覧

| 機能カテゴリ | 機能ID | 機能名 | 優先度 | 概要 |
| :--- | :--- | :--- | :--- | :--- |
| **アカウント管理** | F-ORG-001 | メンバーアカウントのプロビジョニング機能 | 高 | 新規AWSアカウントを、標準化された設定で払い出す。 |
| **セキュリティ統制** | F-ORG-002 | 予防的ガードレール機能 (SCP) | 高 | 組織全体で禁止・制限したい操作を強制的にブロックする。 |
| | F-ORG-003 | 発見的ガードレール機能 | 中 | 意図しないリソース設定やセキュリティリスクを事後的に検知・通知する。 |
| **コスト管理** | F-ORG-004 | コスト監視・通知機能 | 高 | 意図しないコストの発生を早期に検知し、管理者に通知する。 |
| **アクセス管理** | F-ORG-005 | シングルサインオン (SSO) 機能 | 高 | 複数のAWSアカウントへのアクセスを、単一のサインインで一元管理する。 |

### 3.2. 機能詳細

#### F-ORG-001: メンバーアカウントのプロビジョニング機能

| 項目 | 内容 |
| :--- | :--- |
| **概要** | 新規プロジェクトや環境（開発、本番）のために、標準化されたAWSアカウントを提供する。 |
| **入力** | 管理者による構成変更の適用。 |
| **処理** | 1. 構成変更の適用により、AWS Organizations APIを通じて新しいメンバーアカウントを作成する。<br>2. 作成されたアカウントを、用途に応じた適切なOU（例: `Workloads-Dev`, `Workloads-Prd`）に自動的に配置する。<br>3. アカウント作成と同時に、CloudTrailによる操作ログ取得が自動で有効化されること。 |
| **出力** | 標準的なセキュリティ・ガバナンス設定が適用された、利用可能な状態のAWSアカウント。 |

#### F-ORG-002: 予防的ガードレール機能 (SCP)

| 項目 | 内容 |
| :--- | :--- |
| **概要** | サービスコントロールポリシー(SCP)を利用し、組織全体で遵守すべきセキュリティポリシーを強制する。 |
| **入力** | 構成管理コード内に定義されたSCPポリシー。 |
| **処理** | 1. **リージョン制限:** 東京 (`ap-northeast-1`) 以外のリージョンでのリソース作成を、全アカウントで禁止する。但し、東京リージョン以外にしか存在しないサービスを利用する場合は、例外として他リージョンを許容する。<br>2. **特権操作制限:** ルートユーザーによるAPIアクセスをブロックし、誤操作や不正利用のリスクを低減する。<br>3. **セキュリティ設定保護:** 全アカウントにおいて、CloudTrailの無効化や、本管理基盤が設定したIAMロールの削除といった、ガバナンス上重要な設定の変更を禁止する。 |
| **出力** | ポリシーに違反するAPIリクエストに対するDeny（拒否）応答。 |

#### F-ORG-004: コスト監視・通知機能

| 項目 | 内容 |
| :--- | :--- |
| **概要** | 意図しない高額請求を防ぐため、AWS Budgetsを利用してコストの異常を早期に検知する。 |
| **入力** | AWSアカウントの利用料金実績。 |
| **処理** | 1. 組織全体の月間AWS利用料が、設定した予算額（例: \$10）の80%を超過した場合、管理者のメールアドレスにアラートを送信する。<br>2. 予測請求額が予算額の100%を超えると予測された場合にも、同様にアラートを送信する。 |
| **出力** | 管理者へのEメールによる予算超過アラート。 |

#### F-ORG-005: シングルサインオン (SSO) 機能

| 項目 | 内容 |
| :--- | :--- |
| **概要** | IAM Identity Centerを利用し、複数アカウントへの安全かつ効率的なアクセスを実現する。 |
| **入力** | ユーザーによるSSOポータルへのログイン要求。 |
| **処理** | 1. 管理者はIAM Identity Center上でユーザーとグループを定義する。<br>2. 「管理者」「開発者」「参照者」といった権限セット（Permission Set）を作成し、各グループに割り当てる。<br>3. ユーザーはSSOポータルに一度サインインするだけで、自身にアクセスが許可されたAWSアカウントとロールの一覧を閲覧し、選択してコンソールにログインできる。<br>4. 各メンバーアカウントにはIAMユーザーを作成せず、SSOによるアクセスを原則とする。 |
| **出力** | 一時的な認証情報が付与された、各AWSアカウントのマネジメントコンソールセッション。 |


## 4. 非機能要件

本管理基盤が、組織全体のAWS利用を安定的かつ安全に支えるために満たすべき品質要件を定義する。

| 項目 | 要件 |
| :--- | :--- |
| **セキュリティ (Security)** | ・**管理アカウントの保護:** 管理アカウントへのアクセスは、緊急時を除きSSO経由の読み取り専用ロールに限定する。特権操作が必要な場合は、MFAで保護された特定の管理者ロールにスイッチして行う。<br>・**機密情報の管理:** アクセスキーのような静的な認証情報に依存せず、動的な認証を原則とする。アプリケーションの機密情報は、構成管理コードには一切含めないこと。<br>・**状態ファイルの保護:** 構成管理ツールの状態ファイルは、暗号化が有効化されたバックエンドで安全に保管し、開発者のローカル環境には保存しないこと。 |
| **信頼性・可用性 (Reliability / Availability)** | ・**構成管理の信頼性:** インフラの構成はすべてコードで定義し（Infrastructure as Code）、手動での変更は原則禁止とする。すべての変更は、バージョン管理システム上でのレビューと、適用前の影響範囲確認を経て適用されること。<br>・**マルチリージョン障害への耐性:** 本管理基盤を構成する主要サービス（AWS Organizations, IAM Identity Center, Route 53）は、AWSが提供する高可用なグローバルサービスまたはマルチAZサービスを利用する。 |
| **運用・保守性 (Operability / Maintainability)** | ・**コードの可読性:** 構成管理コードは、標準的な規約に従い、第三者が見ても理解しやすい構造を維持する。<br>・**監査証跡の確保:** 誰が、いつ、どのインフラに変更を加えたかの証跡が、バージョン管理システムと構成管理ツールの実行履歴の両方で追跡可能であること。<br>・**テスト容易性:** インフラの変更を適用する前に、その影響範囲を事前にレビューできること。 |
| **パフォーマンス (Performance)** | ・**構成変更の適用時間:** 構成変更の適用（apply）は、リソース数が増加しても現実的な時間（例: 15分以内）で完了すること。 |
| **コスト効率 (Cost Efficiency)** | ・**管理コストの最適化:** 本管理基盤自体の運用コストは、月額\$5未満に抑えることを目標とする。<br>・**コストの可視化:** AWS Organizationsの一括請求機能とAWS Budgetsを活用し、組織全体のコストと各アカウントのコスト内訳を常に把握できる状態を維持する。 |


## 5. その他

### 5.1. 制約事項・前提条件

本管理基盤の設計・構築・運用における制約事項および前提条件を以下に定める。

*   **主要なAWSサービス:**
    *   **組織・アカウント管理:** AWS Organizations
    *   **認証・アクセス管理:** AWS IAM Identity Center
    *   **コスト管理:** AWS Budgets
    *   **DNS管理:** Amazon Route 53

*   **対象リージョン:**
    *   インフラリソースを構築するプライマリリージョンは、**東京リージョン (`ap-northeast-1`)** とする。